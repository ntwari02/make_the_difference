<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Advertisement Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              100: '#BFDBFE',
              200: '#93C5FD',
              300: '#60A5FA',
              400: '#3B82F6',
              500: '#2563EB',
              600: '#1D4ED8',
              700: '#1E40AF',
              800: '#1E3A8A',
              900: '#172554',
            },
          },
          fontFamily: {
            'raleway': ['Raleway', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="font-raleway bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <div class="min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-4">Advanced Advertisement System Test</h1>
        <p class="text-lg mb-8">Testing all advanced features including A/B testing, targeting, analytics, and personalization</p>
      </div>

      <!-- Feature Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <!-- A/B Testing -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
          <div class="text-primary-500 text-3xl mb-4">
            <i class="fas fa-flask"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">A/B Testing</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Test different advertisement variants to optimize performance</p>
          <button onclick="testABTesting()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-all duration-300">
            Test A/B
          </button>
        </div>

        <!-- Targeting -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
          <div class="text-primary-500 text-3xl mb-4">
            <i class="fas fa-crosshairs"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Targeting</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Show ads based on device, browser, time, and user behavior</p>
          <button onclick="testTargeting()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-all duration-300">
            Test Targeting
          </button>
        </div>

        <!-- Analytics -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
          <div class="text-primary-500 text-3xl mb-4">
            <i class="fas fa-chart-line"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Analytics</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Track impressions, clicks, engagement, and conversions</p>
          <button onclick="testAnalytics()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition-all duration-300">
            Test Analytics
          </button>
        </div>

        <!-- Personalization -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
          <div class="text-primary-500 text-3xl mb-4">
            <i class="fas fa-user-cog"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Personalization</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Personalize ads based on user interests and behavior</p>
          <button onclick="testPersonalization()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 transition-all duration-300">
            Test Personalization
          </button>
        </div>

        <!-- Frequency Capping -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
          <div class="text-primary-500 text-3xl mb-4">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Frequency Capping</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Limit ad frequency to prevent user fatigue</p>
          <button onclick="testFrequencyCapping()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-all duration-300">
            Test Frequency
          </button>
        </div>

        <!-- Advanced Controls -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
          <div class="text-primary-500 text-3xl mb-4">
            <i class="fas fa-sliders-h"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Advanced Controls</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Volume, fullscreen, keyboard navigation, and more</p>
          <button onclick="testAdvancedControls()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 transition-all duration-300">
            Test Controls
          </button>
        </div>
      </div>

      <!-- Control Panel -->
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg mb-8">
        <h2 class="text-2xl font-bold mb-4">Control Panel</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <button onclick="clearSession()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-all duration-300">
            Clear Session
          </button>
          <button onclick="forceShowAd()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-all duration-300">
            Force Show Ad
          </button>
          <button onclick="testAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-all duration-300">
            Test API
          </button>
          <button onclick="showUserProfile()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition-all duration-300">
            Show Profile
          </button>
        </div>
      </div>

      <!-- Results Display -->
      <div id="results" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hidden">
        <h3 class="text-xl font-semibold mb-4">Test Results</h3>
        <pre id="results-content" class="bg-gray-100 dark:bg-gray-700 p-4 rounded text-sm overflow-auto max-h-96"></pre>
      </div>

      <!-- User Profile Display -->
      <div id="user-profile" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hidden">
        <h3 class="text-xl font-semibold mb-4">User Profile</h3>
        <div id="profile-content" class="space-y-2"></div>
      </div>
    </div>
  </div>

  <script src="js/advertisement-config.js"></script>
  <script src="js/ad-support-classes.js"></script>
  <script src="js/advanced-advertisement.js"></script>
  <script>
    // Test functions
    function testABTesting() {
      const abTesting = new ABTesting();
      abTesting.initialize();
      showResults('A/B Testing', {
        testId: abTesting.testId,
        variant: abTesting.variant,
        variants: window.AdvertisementConfig?.AB_TEST_VARIANTS || ['A', 'B']
      });
    }

    function testTargeting() {
      const targeting = new AdvertisementTargeting();
      const shouldShow = targeting.shouldShowAd();
      showResults('Targeting Test', {
        deviceType: targeting.getDeviceType(),
        browser: targeting.getBrowser(),
        timeOfDay: targeting.getTimeOfDay(),
        dayOfWeek: targeting.getDayOfWeek(),
        shouldShowAd: shouldShow,
        targetingRules: window.AdvertisementConfig?.TARGETING_RULES
      });
    }

    function testAnalytics() {
      const analytics = new AdvertisementAnalytics();
      analytics.initialize({ id: 1, title: 'Test Ad' });
      analytics.trackImpression({ id: 1, title: 'Test Ad' });
      analytics.trackClick({ id: 1, title: 'Test Ad' });
      showResults('Analytics Test', {
        startTime: analytics.startTime,
        engagementTime: analytics.engagementTime,
        message: 'Analytics events sent to console'
      });
    }

    function testPersonalization() {
      const personalization = new AdvertisementPersonalization();
      personalization.initialize({ id: 1, title: 'Test Ad', category: 'education' });
      showResults('Personalization Test', {
        isPersonalized: personalization.isPersonalized(),
        interests: personalization.getStoredInterests(),
        behavior: personalization.getStoredBehavior()
      });
    }

    function testFrequencyCapping() {
      const frequencyCapping = new FrequencyCapping();
      const canShow = frequencyCapping.canShowAd();
      showResults('Frequency Capping Test', {
        canShowAd: canShow,
        dailyCount: frequencyCapping.getDailyCount(),
        weeklyCount: frequencyCapping.getWeeklyCount(),
        monthlyCount: frequencyCapping.getMonthlyCount(),
        limits: frequencyCapping.config
      });
    }

    function testAdvancedControls() {
      showResults('Advanced Controls Test', {
        volumeControl: window.AdvertisementConfig?.SHOW_VOLUME_CONTROL,
        fullscreenButton: window.AdvertisementConfig?.SHOW_FULLSCREEN_BUTTON,
        progressBar: window.AdvertisementConfig?.SHOW_PROGRESS_BAR,
        keyboardNavigation: window.AdvertisementConfig?.ACCESSIBILITY?.ENABLE_KEYBOARD_NAVIGATION,
        screenReader: window.AdvertisementConfig?.ACCESSIBILITY?.ENABLE_SCREEN_READER
      });
    }

    function clearSession() {
      sessionStorage.removeItem(window.AdvertisementConfig?.LAST_AD_TIME_KEY || 'lastAdTime');
      sessionStorage.removeItem('abTestId');
      sessionStorage.removeItem('abTestVariant');
      localStorage.removeItem('adImpressions');
      localStorage.removeItem('userInterests');
      localStorage.removeItem('userBehavior');
      showResults('Session Cleared', {
        message: 'All session and local storage data cleared',
        timestamp: new Date().toISOString()
      });
    }

    function forceShowAd() {
      sessionStorage.removeItem(window.AdvertisementConfig?.LAST_AD_TIME_KEY || 'lastAdTime');
      location.reload();
    }

    async function testAPI() {
      try {
        const response = await fetch('/api/advertisements/active');
        const data = await response.json();
        showResults('API Test', data);
      } catch (error) {
        showResults('API Test Error', { error: error.message });
      }
    }

    function showUserProfile() {
      const profile = {
        deviceType: getDeviceType(),
        browser: getBrowser(),
        timeOfDay: getTimeOfDay(),
        dayOfWeek: getDayOfWeek(),
        interests: getStoredInterests(),
        behavior: getStoredBehavior(),
        preferences: getStoredPreferences()
      };

      const profileDiv = document.getElementById('user-profile');
      const contentDiv = document.getElementById('profile-content');
      
      contentDiv.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <h4 class="font-semibold text-primary-600">Device Information</h4>
            <p><strong>Device:</strong> ${profile.deviceType}</p>
            <p><strong>Browser:</strong> ${profile.browser}</p>
            <p><strong>Time of Day:</strong> ${profile.timeOfDay}</p>
            <p><strong>Day of Week:</strong> ${profile.dayOfWeek}</p>
          </div>
          <div>
            <h4 class="font-semibold text-primary-600">User Data</h4>
            <p><strong>Interests:</strong> ${profile.interests.join(', ') || 'None'}</p>
            <p><strong>Total Ads Viewed:</strong> ${profile.behavior.totalAdsViewed || 0}</p>
            <p><strong>Last Category:</strong> ${profile.behavior.lastAdCategory || 'None'}</p>
          </div>
        </div>
      `;
      
      profileDiv.classList.remove('hidden');
    }

    function showResults(title, data) {
      const resultsDiv = document.getElementById('results');
      const contentDiv = document.getElementById('results-content');
      
      contentDiv.textContent = `${title}:\n${JSON.stringify(data, null, 2)}`;
      resultsDiv.classList.remove('hidden');
      
      // Hide user profile when showing results
      document.getElementById('user-profile').classList.add('hidden');
    }

    // Helper functions
    function getDeviceType() {
      const userAgent = navigator.userAgent;
      if (/Mobile|Android|iPhone|iPad/.test(userAgent)) {
        return /iPad/.test(userAgent) ? 'tablet' : 'mobile';
      }
      return 'desktop';
    }

    function getBrowser() {
      const userAgent = navigator.userAgent;
      if (userAgent.includes('Chrome')) return 'chrome';
      if (userAgent.includes('Firefox')) return 'firefox';
      if (userAgent.includes('Safari')) return 'safari';
      if (userAgent.includes('Edge')) return 'edge';
      return 'unknown';
    }

    function getTimeOfDay() {
      const hour = new Date().getHours();
      if (hour >= 5 && hour < 12) return 'morning';
      if (hour >= 12 && hour < 17) return 'afternoon';
      if (hour >= 17 && hour < 21) return 'evening';
      return 'night';
    }

    function getDayOfWeek() {
      const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
      return days[new Date().getDay()];
    }

    function getStoredInterests() {
      try {
        return JSON.parse(localStorage.getItem('userInterests') || '[]');
      } catch {
        return [];
      }
    }

    function getStoredBehavior() {
      try {
        return JSON.parse(localStorage.getItem('userBehavior') || '{}');
      } catch {
        return {};
      }
    }

    function getStoredPreferences() {
      try {
        return JSON.parse(localStorage.getItem('adPreferences') || '{}');
      } catch {
        return {};
      }
    }
  </script>
</body>
</html>
