<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Admin System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/api.js"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-8">Admin System Debug</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Admin Status Check -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Admin Table Status</h2>
                <button id="checkAdminStatus" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 mb-4">
                    Check Admin Status
                </button>
                <div id="adminStatusResult" class="text-sm text-gray-600 dark:text-gray-300"></div>
            </div>

            <!-- Manual Migration -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Manual Migration</h2>
                <button id="migrateAdmins" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 mb-4">
                    Migrate Admin Users
                </button>
                <div id="migrationResult" class="text-sm text-gray-600 dark:text-gray-300"></div>
            </div>

            <!-- Ensure Admin Setup -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Ensure Admin Setup</h2>
                <button id="ensureAdminSetup" class="bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 mb-4">
                    Ensure Admin Setup
                </button>
                <div id="setupResult" class="text-sm text-gray-600 dark:text-gray-300"></div>
            </div>

            <!-- Create Admin User -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Create Admin User</h2>
                <form id="createAdminForm" class="space-y-4">
                    <input type="email" id="createAdminEmail" placeholder="User Email" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <select id="createAdminLevel" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="admin">Admin</option>
                        <option value="super_admin">Super Admin</option>
                        <option value="moderator">Moderator</option>
                    </select>
                    <button type="submit" class="bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600">
                        Create Admin
                    </button>
                </form>
                <div id="createAdminResult" class="text-sm text-gray-600 dark:text-gray-300 mt-4"></div>
            </div>

            <!-- Test Login -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Test Login</h2>
                <form id="testLoginForm" class="space-y-4">
                    <input type="email" id="testEmail" placeholder="Email" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <input type="password" id="testPassword" placeholder="Password" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <button type="submit" class="bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600">
                        Test Login
                    </button>
                </form>
                <div id="loginResult" class="text-sm text-gray-600 dark:text-gray-300 mt-4"></div>
            </div>

            <!-- Current User Info -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Current User Info</h2>
                <button id="checkCurrentUser" class="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600 mb-4">
                    Check Current User
                </button>
                <div id="currentUserResult" class="text-sm text-gray-600 dark:text-gray-300"></div>
            </div>
        </div>
    </div>

    <script>
        // Check Admin Status
        document.getElementById('checkAdminStatus').addEventListener('click', async () => {
            try {
                const result = await window.api.get('/admin/debug/admin-status');
                document.getElementById('adminStatusResult').innerHTML = `
                    <pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded text-xs overflow-auto">${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('adminStatusResult').innerHTML = `
                    <div class="text-red-500">Error: ${error.message}</div>
                `;
            }
        });

        // Migrate Admins
        document.getElementById('migrateAdmins').addEventListener('click', async () => {
            try {
                const result = await window.api.post('/admin/migrate-admins');
                document.getElementById('migrationResult').innerHTML = `
                    <div class="text-green-500">${result.message}</div>
                    <pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded text-xs overflow-auto mt-2">${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('migrationResult').innerHTML = `
                    <div class="text-red-500">Error: ${error.message}</div>
                `;
            }
        });

        // Ensure Admin Setup
        document.getElementById('ensureAdminSetup').addEventListener('click', async () => {
            try {
                const result = await window.api.post('/admin/ensure-admin-setup');
                document.getElementById('setupResult').innerHTML = `
                    <div class="text-green-500">${result.message}</div>
                    <pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded text-xs overflow-auto mt-2">${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('setupResult').innerHTML = `
                    <div class="text-red-500">Error: ${error.message}</div>
                `;
            }
        });

        // Create Admin User
        document.getElementById('createAdminForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('createAdminEmail').value;
            const level = document.getElementById('createAdminLevel').value;
            
            try {
                const result = await window.api.post('/admin/create-admin', { email, level });
                document.getElementById('createAdminResult').innerHTML = `
                    <div class="text-green-500">Admin user created!</div>
                    <pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded text-xs overflow-auto mt-2">${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('createAdminResult').innerHTML = `
                    <div class="text-red-500">Error creating admin user: ${error.message}</div>
                `;
            }
        });

        // Test Login
        document.getElementById('testLoginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            
            try {
                const result = await window.api.post('/auth/login', { email, password });
                document.getElementById('loginResult').innerHTML = `
                    <div class="text-green-500">Login successful!</div>
                    <pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded text-xs overflow-auto mt-2">${JSON.stringify(result, null, 2)}</pre>
            `;
            } catch (error) {
                document.getElementById('loginResult').innerHTML = `
                    <div class="text-red-500">Login failed: ${error.message}</div>
                `;
            }
        });

        // Check Current User
        document.getElementById('checkCurrentUser').addEventListener('click', () => {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            document.getElementById('currentUserResult').innerHTML = `
                <div><strong>Token:</strong> ${token ? 'Present' : 'Not found'}</div>
                <div><strong>User:</strong> ${user ? 'Present' : 'Not found'}</div>
                ${user ? `<pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded text-xs overflow-auto mt-2">${JSON.stringify(JSON.parse(user), null, 2)}</pre>` : ''}
            `;
        });
    </script>
</body>
</html> 